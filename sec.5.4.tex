\label{sec:5.4}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%(Prakash) Discuss SHA/MUX linearity
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

The input signals are sampled at a rate of 2 MS/s, multiplexed by 8 and digitized by one of two calibrated 12-bit pipelined ADCs operating at 16 MS/s. The overall integral non-linearity of the ADC is due to the integral non-linearity of the front-end (SDC), SHA, MUX as well as the overall integral non-linearity in the ADC transfer function. 

%Measuring the linearity at different configurations helped us to narrow down the problem.
Programming the ColdADC in ADC only mode, frozen SHA mode and free running SHA mode, we were able to measure linearity for ADC only, ADC $+$ SHA and ADC $+$ SHA $+$ MUX configurations. The linearity of the ADC is approximately reduced by 0.3 LSB when SHA is in free running mode, i.e ADC $+$ SHA $+$ MUX. We did not observe any noticeable degradation of linearity between ADC only and frozen SHA mode. However, during the frozen SHA mode we observed that overall linearity is slightly different for different sample sets. 

During the frozen SHA mode, the ADC will over sample the SHA output by a factor of 8 and the linearity of the ADC can be calculated by taking any of the samples. Figure \ref{fig:sha_sample_hist} show that the samples are not consistent and non-linearity has been introduced by SHA/MUX combination. The main source of non-linearity could be SHA op-amps or the MUX.
%Studies were performed at two configuration settings, forzen SHA mode and free running SHA mode. Nominal operation is free running SHA mode. 
\begin{figure}[h!]
\centering
  \includegraphics[width=0.7\linewidth]{figures/prakash_fig/sha_sample_hist.JPG}
  \caption{Histogram of ADC sampling in frozen SHA configuration}
  \label{fig:sha_sample_hist}
\end{figure}

To narrow down if any of this non-linearity was causing by the SHA op-amps, we varied the SHA bias current. The change in the SHA bias current did not affect the overall linearity of the ADC, and therefore, we were able to rule out SHA op-amps as the source of non-linearity. Figure~\ref{fig:linearity_sha_current} shows the linearity of ADC measured by looking at the second sample of channel 7 at 40$\mu$A, 50$\mu$A (default) and 60$\mu$A SHA bias currents. These measurements were taken at room temperature with nominal sample rate. 
\begin{figure}[h!]
\centering
  \includegraphics[width=1.0\linewidth]{figures/prakash_fig/linearity_sha_current.png}
  \caption{Linearity of ADC at room temperature with SHA bias current configured to 40, 50, and 60 $\mu$A.}
  \label{fig:linearity_sha_current}
\end{figure}

For our next experiment, we reduced the sampling speed of the ADC. With reduced sampling speed the MUX's will have more time to settle and there will not be any kickback. Figure~\ref{fig:linearity_mux_speed} shows the overall linearity at different sampling clocks. Reducing the sampling frequency improves the linearity significantly. The MUX's seem to be causing the non-linearity and we believe the kickback is the main source of the problem. To address this problem we plan to redesign the MUX to be much faster.
\begin{figure}[h!]
\centering
  \includegraphics[width=1.0\linewidth]{figures/prakash_fig/linearity_mux_speed.png}
  \caption{Linearity of ADC at room temperature with 2, 1, 0.5 MHz sampling frequencies.}
  \label{fig:linearity_mux_speed}
\end{figure}

During the free running SHA configuration, we observed overall reduction in linearity (approximately 0.3 LSB). While running more experiments in this configuration, spikes were observed in the DNL plots. Appearance of these spikes only in free running SHA mode and not in frozen SHA mode point to issues with the MUX. Cooling down the ColdADC affects the magnitude of spikes in the DNL plots. Figure \ref{fig:linearity_free_frozen} show the difference in linearity for free running SHA mode and frozen SHA mode. These measurements were performed with nominal clocks and nominal reference voltages at LN2 temperature and 10 most extreme values are labeled in the plots. A possible explanation for this is the ON resistance of the switches (MUX) is significantly larger at cold than at room temperature. Redesigning the MUX to be faster will solve this problem. 
\begin{figure}[h!]
\centering
  \includegraphics[width=1\linewidth]{figures/prakash_fig/linearity_free_frozen.png}
  \caption{Linearity comparison of the ADC with single ended input in free running SHA and frozen SHA mode}
  \label{fig:linearity_free_frozen}
\end{figure}

Evidence of linearity degradation only during the free running SHA mode indicate couple other possible issues: possible overlapping of the clocks for the MUX's and/or insufficient settling of MUX's. It is very difficult to simulate MUX's effects on ADC linearity. We are still in the process of understanding and proving the root cause for linearity degradation in simulations. To fix this, we will redesign the MUX's to be faster and improve the clocking scheme. 


